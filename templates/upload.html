<!DOCTYPE html>
<html lang="{{ g.lang }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ _('ุชุญููู ูุชุตููู ุงููุทุฑูุงุช') }}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    </head>
<body style="direction: {{ 'rtl' if g.lang == 'ar' else 'ltr' }};">
    <div id="welcome-splash">
        <div class="welcome-content">
            <span class="icon">๐</span>
            <h1>{{ _('ุฃููุงู ุจู ูู ูุธุงู ุชุญููู ุงููุทุฑูุงุช') }}</h1>
            </div>
    </div>
    <div class="lang-switch">
        {% if g.lang == 'ar' %}English{% else %}ุงูุนุฑุจูุฉ{% endif %}
    </div>

    <div id="loader-wrapper" class="loader-wrapper" style="display:none;">
        <div class="loader"></div>
        <p id="loading-text">{{ _('ุฌุงุฑู ุงูุชุญููู...') }}</p>
    </div>

    <main class="container">
        <div class="card upload-box">
            <h1><span class="icon">๐</span> {{ _('ูุธุงู ุชุญููู ูุชุตููู ุงููุทุฑูุงุช') }}</h1>
            {% with messages = get_flashed_messages(with_categories=true) %}
              {% if messages %}
                <div class="flash-messages">
                  {% for category, msg in messages %}
                    <div class="flash {{ category }}">{{ msg }}</div>
                  {% endfor %}
                </div>
              {% endif %}
            {% endwith %}

            <form method="post" enctype="multipart/form-data" id="upload-form">
                <label for="file-upload" class="custom-file-upload">
                    <span class="file-upload-icon">โ๏ธ</span> <span id="file-upload-text">{{ _('ุงุฎุชุฑ ุตูุฑุฉ ูุทุฑ ููุชุญููู ุฃู ุงุณุญุจูุง ููุง') }}</span>
                </label>
                <input id="file-upload" type="file" name="file" accept="image/png, image/jpeg" required>
                <button type="submit" class="submit-button"><span>๐</span> {{ _('ุจุฏุก ุงูุชุญููู') }}</button>
            </form>
        </div>

        {% if image_url or predictions %}
        <div class="card result-box">
            {% if image_url %}
                <h3>{{ _('ุงูุตูุฑุฉ ุงููุฑููุนุฉ') }}</h3>
                <img src="{{ url_for('uploaded_file', filename=image_url) }}" class="preview" alt="{{ _('ุงูุตูุฑุฉ ุงููุฑููุนุฉ ูุชุญููู ุงููุทุฑ') }}">
            {% endif %}

            {% if predictions %}
                <h3>{{ _('ูุชุงุฆุฌ ุงูุชุตููู (ุงูุฃุนูู ุซูุฉ)') }}</h3>
                {% for pred in predictions %}
                <div class="prediction-item {% if pred.is_top %}top{% endif %}" style="--i: {{ loop.index0 }};">
                    <div class="prediction-header">
                        <span>{{ pred['class'] }}</span>
                        <strong>{{ pred.confidence }}</strong>
                    </div>
                    <div class="confidence-bar">
                        <div class="confidence-fill" data-width="{{ pred.confidence.replace('%','') }}"></div>
                    </div>
                </div>
                {% endfor %}

                {% if full_taxonomy %}
                <div class="taxonomy-details">
                    <h3>{{ _('ุงูุชุตููู ุงูุนููู ุงูุชูุตููู') }}</h3>
                    <ul>
                        {% for rank, val in full_taxonomy.items() %}
                            {% if rank not in ['Cultivation_Details','Nutritional_Info'] %}
                                <li><strong>{{ _(rank) }}:</strong> <span>{{ val }}</span></li>
                            {% endif %}
                        {% endfor %}
                    </ul>

                    <h3>{{ _('ูุนูููุงุช ุฅุถุงููุฉ') }}</h3>

                    {# ุฒุฑุงุนุฉ #}
                    {% if full_taxonomy['Cultivation'] %}
                        <h4>{{ _('ุฒุฑุงุนุฉ') }}</h4>
                        <p><strong>{{ _('ุงูุฒุฑุงุนุฉ:') }}</strong> {{ full_taxonomy['Cultivation'] }}</p>
                    {% endif %}

                    {# ุฌุฏูู ูุนูููุงุช ุงูุฒุฑุงุนุฉ #}
                    {% if full_taxonomy.Cultivation_Details %}
                        <h4>{{ _('ุชูุงุตูู ุงูุฒุฑุงุนุฉ') }}</h4>
                        <div class="table-container">
                            <table class="cultivation-table">
                                <thead>
                                    <tr>
                                        <th>{{ _('ุงูุฑููุฒุฉ') }}</th>
                                        <th>{{ _('ุงูุธุฑูู') }}</th>
                                        <th>{{ _('ุงูุฌุฏูู ุงูุฒููู') }}</th>
                                        <th>{{ _('ุงูุฅูุชุงุฌ') }}</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>{{ full_taxonomy.Cultivation_Details.Substrate or _('ุบูุฑ ูุชููุฑ') }}</td>
                                        <td>{{ full_taxonomy.Cultivation_Details.Conditions or _('ุบูุฑ ูุชููุฑ') }}</td>
                                        <td>{{ full_taxonomy.Cultivation_Details.Timeline or _('ุบูุฑ ูุชููุฑ') }}</td>
                                        <td>{{ full_taxonomy.Cultivation_Details.Yield or _('ุบูุฑ ูุชููุฑ') }}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    {% endif %}

                    {# ุงุณุชุฎุฏุงูุงุช #}
                    {% if full_taxonomy['Uses'] %}
                        <h4>{{ _('ุงูุงุณุชุฎุฏุงูุงุช') }}</h4>
                        <p><strong>{{ _('ุงูุงุณุชุฎุฏุงูุงุช:') }}</strong> {{ full_taxonomy['Uses'] }}</p>
                    {% endif %}

                    {# ูุนูููุงุช ุบุฐุงุฆูุฉ #}
                    {% set ni = full_taxonomy.get('Nutritional_Info') %}
                    {% if ni %}
                        <h4>{{ _('ูุนูููุงุช ุบุฐุงุฆูุฉ') }}</h4>
                        <p><strong>{{ _('ุงูููุงุฆุฏ:') }}</strong> {{ ni['Benefits'] or _('ุบูุฑ ูุชููุฑ') }}</p>
                        <p><strong>{{ _('ุงููุฎุงุทุฑ:') }}</strong> {{ ni['Risks'] or _('ุบูุฑ ูุชููุฑ') }}</p>
                    {% endif %}

                    {# ูุนูููุงุช ุฅุถุงููุฉ ุนุงูุฉ #}
                    {% if full_taxonomy['Additional_Info'] %}
                        <p><strong>{{ _('ูุนูููุงุช ุฅุถุงููุฉ:') }}</strong> {{ full_taxonomy['Additional_Info'] }}</p>
                    {% endif %}
                </div>
                {% elif taxonomy_message %}
                    <p class="taxonomy-message">{{ taxonomy_message }}</p>
                {% endif %}
            {% endif %}
        </div>
        {% endif %}

        <footer class="page-footer">{{ _('ูุธุงู ุชุฌุฑูุจู ูุชุตููู ุงููุทุฑูุงุช - ุฅุตุฏุงุฑ 1.1') }}</footer> </main>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>